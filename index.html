<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>糸通し風ゲーム</title>
    <style>
        body { margin: 0; overflow: hidden; background: #eee; font-family: sans-serif; }
        canvas { display: block; background: #fff; margin: 20px auto; border: 2px solid #333; }
        .info { text-align: center; }
    </style>
</head>
<body>
    <div class="info">クリック/スペースキーで上昇！</div>
    <canvas id="gameCanvas" width="400" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ゲーム設定
        const config = {
            gravity: 0.25,      // 重力（下降速度）
            lift: -0.6,         // 上昇力（クリック時）
            drag: 0.98,         // 速度の減衰
            gap: 200,           // 障害物の隙間
            obstacleWidth: 50
        };

        let player = { x: 50, y: 300, vY: 0 };
        let obstacles = [];
        let frame = 0;
        let isPressing = false;
        let score = 0;
        let gameOver = false;

        // 入力検知
        window.onmousedown = () => isPressing = true;
        window.onmouseup = () => isPressing = false;
        window.onkeydown = (e) => { if(e.code === 'Space') isPressing = true; };
        window.onkeyup = (e) => { if(e.code === 'Space') isPressing = false; };

        function createObstacle() {
            const minHeight = 50;
            const maxHeight = canvas.height - config.gap - minHeight;
            const topH = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
            obstacles.push({ x: canvas.width, topH: topH });
        }

        function update() {
            if (gameOver) return;

            // プレイヤーの移動
            if (isPressing) {
                player.vY += config.lift;
            }
            player.vY += config.gravity;
            player.vY *= config.drag;
            player.y += player.vY;

            // 障害物の生成と移動
            if (frame % 100 === 0) createObstacle();
            
            obstacles.forEach((obs, index) => {
                obs.x -= 3; // スピード

                // 当たり判定
                if (player.x + 10 > obs.x && player.x < obs.x + config.obstacleWidth) {
                    if (player.y < obs.topH || player.y > obs.topH + config.gap) {
                        gameOver = true;
                    }
                }

                // スコア加算
                if (obs.x + config.obstacleWidth === 50) score++;
                
                // 画面外に出た障害物を削除
                if (obs.x < -config.obstacleWidth) obstacles.splice(index, 1);
            });

            // 画面外判定
            if (player.y < 0 || player.y > canvas.height) gameOver = true;

            frame++;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // プレイヤー（糸）
            ctx.fillStyle = "red";
            ctx.beginPath();
            ctx.arc(player.x, player.y, 8, 0, Math.PI * 2);
            ctx.fill();

            // 障害物
            ctx.fillStyle = "#333";
            obstacles.forEach(obs => {
                ctx.fillRect(obs.x, 0, config.obstacleWidth, obs.topH);
                ctx.fillRect(obs.x, obs.topH + config.gap, config.obstacleWidth, canvas.height);
            });

            // スコア
            ctx.fillStyle = "#000";
            ctx.font = "20px Arial";
            ctx.fillText(`Score: ${score}`, 10, 30);

            if (gameOver) {
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fillRect(0,0,canvas.width, canvas.height);
                ctx.fillStyle = "white";
                ctx.fillText("GAME OVER", canvas.width/2 - 60, canvas.height/2);
                ctx.fillText("Click to Restart", canvas.width/2 - 70, canvas.height/2 + 40);
            }
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        canvas.onclick = () => {
            if (gameOver) {
                player = { x: 50, y: 300, vY: 0 };
                obstacles = [];
                score = 0;
                gameOver = false;
                frame = 0;
            }
        };

        loop();
    </script>
</body>
</html>
